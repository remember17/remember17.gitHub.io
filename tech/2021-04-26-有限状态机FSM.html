<!DOCTYPE html><html> <head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>æœ‰é™çŠ¶æ€æœºFSM - FiveHow</title><link rel="stylesheet" href="/gitbook/style.css"><link rel="stylesheet" href="/gitbook/rouge-highlight-colorful.css"></head> <body> <div class="book"> <div class="book-body"> <div class="body-inner"> <div class="page-wrapper" tabindex="-1" role="main"> <div class="page-inner"> <section class="normal markdown-section"> <h1 id="æœ‰é™çŠ¶æ€æœºfsm">æœ‰é™çŠ¶æ€æœºFSM</h1>
<h3 id="ä¸€ä»€ä¹ˆæ˜¯æœ‰é™çŠ¶æ€æœº">ä¸€ã€ä»€ä¹ˆæ˜¯æœ‰é™çŠ¶æ€æœº</h3>
<p>æœ‰é™çŠ¶æ€æœºç®€å†™ä¸ºFSMï¼ˆFinite State Machineï¼‰ï¼Œå®ƒæœ‰4ä¸ªè¦ç´ ï¼Œå³ç°æ€ã€æ¡ä»¶ã€åŠ¨ä½œã€æ¬¡æ€ã€‚â€œç°æ€â€å’Œâ€œæ¡ä»¶â€æ˜¯å› ï¼Œâ€œåŠ¨ä½œâ€å’Œâ€œæ¬¡æ€â€æ˜¯æœã€‚</p>
<ul>
<li>ç°æ€ï¼šæ˜¯æŒ‡å½“å‰æ‰€å¤„çš„çŠ¶æ€ã€‚</li>
<li>æ¡ä»¶ï¼šåˆç§°ä¸ºâ€œäº‹ä»¶â€ï¼Œå½“ä¸€ä¸ªæ¡ä»¶è¢«æ»¡è¶³ï¼Œå°†ä¼šè§¦å‘ä¸€ä¸ªåŠ¨ä½œï¼Œæˆ–è€…æ‰§è¡Œä¸€æ¬¡çŠ¶æ€çš„è¿ç§»ã€‚</li>
<li>åŠ¨ä½œï¼šæ¡ä»¶æ»¡è¶³åæ‰§è¡Œçš„åŠ¨ä½œã€‚åŠ¨ä½œæ‰§è¡Œå®Œæ¯•åï¼Œå¯ä»¥è¿ç§»åˆ°æ–°çš„çŠ¶æ€ï¼Œä¹Ÿå¯ä»¥ä»æ—§ä¿æŒåŸçŠ¶æ€ã€‚åŠ¨ä½œä¸æ˜¯å¿…éœ€çš„ï¼Œå½“æ¡ä»¶æ»¡è¶³åï¼Œä¹Ÿå¯ä»¥ä¸æ‰§è¡Œä»»ä½•åŠ¨ä½œï¼Œç›´æ¥è¿ç§»åˆ°æ–°çŠ¶æ€ã€‚</li>
<li>æ¬¡æ€ï¼šæ¡ä»¶æ»¡è¶³åè¦è¿å¾€çš„æ–°çŠ¶æ€ã€‚â€œæ¬¡æ€â€æ˜¯ç›¸å¯¹äºâ€œç°æ€â€è€Œè¨€çš„ï¼Œâ€œæ¬¡æ€â€ä¸€æ—¦è¢«æ¿€æ´»ï¼Œå°±è½¬å˜æˆæ–°çš„â€œç°æ€â€äº†ã€‚</li>
</ul>
<h3 id="äºŒflutterä¸­çš„bloc">äºŒã€Flutterä¸­çš„Bloc</h3>
<p>è§¦å‘äº‹ä»¶ ---> blocæ´¾å‘event ---> blocä¸­mapæ ¹æ®ä¸åŒçš„eventæ‰§è¡Œä¸åŒé€»è¾‘ ---> ç”Ÿæˆæ–°çš„çŠ¶æ€state --->  é¡µé¢æ ¹æ®æ–°çš„çŠ¶æ€é‡æ–°æ¸²æŸ“</p>
<h3 id="ä¸‰redux">ä¸‰ã€Redux</h3>
<ul>
<li>Store å°±æ˜¯ä¿å­˜æ•°æ®çš„åœ°æ–¹ï¼Œä½ å¯ä»¥æŠŠå®ƒçœ‹æˆä¸€ä¸ªå®¹å™¨ã€‚æ•´ä¸ªåº”ç”¨åªèƒ½æœ‰ä¸€ä¸ª Storeã€‚</li>
<li>State çš„å˜åŒ–ï¼Œä¼šå¯¼è‡´ View çš„å˜åŒ–ã€‚ä½†æ˜¯ï¼Œç”¨æˆ·æ¥è§¦ä¸åˆ° Stateï¼Œåªèƒ½æ¥è§¦åˆ° Viewã€‚æ‰€ä»¥ï¼ŒState çš„å˜åŒ–å¿…é¡»æ˜¯ View å¯¼è‡´çš„ã€‚</li>
<li>Action å°±æ˜¯ View å‘å‡ºçš„é€šçŸ¥ï¼Œè¡¨ç¤º State åº”è¯¥è¦å‘ç”Ÿå˜åŒ–äº†ã€‚store.dispatch()æ˜¯ View å‘å‡º Action çš„å”¯ä¸€æ–¹æ³•ã€‚</li>
<li>Store æ”¶åˆ° Action ä»¥åï¼Œå¿…é¡»ç»™å‡ºä¸€ä¸ªæ–°çš„ Stateï¼Œè¿™æ · View æ‰ä¼šå‘ç”Ÿå˜åŒ–ã€‚è¿™ç§ State çš„è®¡ç®—è¿‡ç¨‹å°±å«åš Reducerã€‚</li>
<li>Reducer æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œå®ƒæ¥å— Action å’Œå½“å‰ State ä½œä¸ºå‚æ•°ï¼Œè¿”å›ä¸€ä¸ªæ–°çš„ Stateã€‚</li>
<li>Reducer å‡½æ•°æœ€é‡è¦çš„ç‰¹å¾æ˜¯ï¼Œå®ƒæ˜¯ä¸€ä¸ªçº¯å‡½æ•°ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œåªè¦æ˜¯åŒæ ·çš„è¾“å…¥ï¼Œå¿…å®šå¾—åˆ°åŒæ ·çš„è¾“å‡ºã€‚</li>
</ul>
<h3 id="å››iosä¸­å®ç°ä¸€ä¸ªfsm-transitionkit">å››ã€iOSä¸­å®ç°ä¸€ä¸ªFSM( <a href="https://github.com/blakewatters/TransitionKit">TransitionKit</a>)</h3>
<h5 id="ä¸‰æ–¹åº“transitionkit"><a href="https://github.com/blakewatters/TransitionKit">ä¸‰æ–¹åº“ï¼šTransitionKit</a></h5>
<h5 id="1state">1.State</h5>
<p>æ¯ä¸ªçŠ¶æ€æœ‰å››ä¸ªé—­åŒ…ï¼Œå¯ä»¥åœ¨åˆ›å»ºStateçš„æ—¶å€™ä¼ å…¥action</p>
<ul>
<li>WillExit</li>
<li>WillEnter</li>
<li>DidExit</li>
<li>DidEnter</li>
</ul>
<h5 id="2event">2.Event</h5>
<p>æ¯ä¸ªEventä»£è¡¨ä»æŸä¸ªçŠ¶æ€ï¼ˆsourceStatesï¼‰å˜åŒ–åˆ°å¦ä¸€ä¸ªçŠ¶æ€ï¼ˆdestinationStateï¼‰</p>
<ul>
<li>sourceStatesæ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œå¯ä»¥å˜åˆ°destinationStateçš„Stateéƒ½å¯ä»¥æ”¾åœ¨æ•°ç»„ä¸­</li>
<li>eventæœ‰WillFireå’ŒDidFireé—­åŒ…ï¼Œä»¥ä¼ å…¥action</li>
</ul>
<h5 id="3transition">3.Transition</h5>
<p>ç”¨æ¥è¿è¾“Stateå˜åŒ–è¿‡ç¨‹ä¸­çš„å„ä¸ªå¯¹è±¡ï¼ŒåŒ…æ‹¬ï¼š</p>
<ul>
<li>event</li>
<li>sourceState</li>
<li>destinationState</li>
<li>stateMachine</li>
<li>userInfo ï¼ˆæ‰©å±•å‚æ•°ï¼Œåœ¨Machineè§¦å‘eventçš„æ—¶å€™ä¼ å…¥ï¼‰</li>
</ul>
<h5 id="4machine">4.Machine</h5>
<p>FSMæ§åˆ¶ä¸­å¿ƒ</p>
<ul>
<li>
<ol>
<li>æŒæœ‰æ‰€æœ‰States</li>
</ol>
</li>
<li>
<ol start="2">
<li>æŒæœ‰æ‰€æœ‰Event</li>
</ol>
</li>
<li>
<ol start="3">
<li>éœ€è¦èµ‹äºˆä¸€ä¸ªåˆå§‹çš„state</li>
</ol>
</li>
<li>
<ol start="4">
<li>è°ƒç”¨activateå¯åŠ¨Machine</li>
</ol>
</li>
<li>
<ol start="5">
<li>è°ƒç”¨fireEventè§¦å‘çŠ¶æ€çš„åˆ‡æ¢ï¼Œè§¦å‘è¿‡ç¨‹ä¼šåˆ†åˆ«è°ƒç”¨stateå’Œeventçš„é—­åŒ…å®ç°actionï¼Œå¹¶ä¸”ä¼šå‘é€ä¸€ä¸ªé€šçŸ¥</li>
</ol>
</li>
</ul>
<h5 id="5ä¾‹å­">5.ä¾‹å­</h5>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="objective-c"><code><span class="line"><span style="color:#6A737D"> 	// 1.æ ¸å¿ƒmachine</span></span>
<span class="line"><span style="color:#E1E4E8">    TKStateMachine </span><span style="color:#F97583">*</span><span style="color:#E1E4E8">machine </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> [[TKStateMachine </span><span style="color:#79B8FF">alloc</span><span style="color:#E1E4E8">] </span><span style="color:#79B8FF">init</span><span style="color:#E1E4E8">];</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#6A737D">    // 2.å®šä¹‰æœªè¯»çŠ¶æ€</span></span>
<span class="line"><span style="color:#E1E4E8">    TKState </span><span style="color:#F97583">*</span><span style="color:#E1E4E8">unread </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> [TKState </span><span style="color:#79B8FF">stateWithName:</span><span style="color:#9ECBFF">@"unread"</span><span style="color:#E1E4E8">];</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#E1E4E8">    [unread </span><span style="color:#79B8FF">setWillExitStateBlock:</span><span style="color:#F97583">^</span><span style="color:#E1E4E8">(TKState </span><span style="color:#F97583">*</span><span style="color:#E1E4E8">state, TKTransition </span><span style="color:#F97583">*</span><span style="color:#E1E4E8">transition) {</span></span>
<span class="line"><span style="color:#79B8FF">        NSString</span><span style="color:#F97583"> *</span><span style="color:#E1E4E8">userInfo </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> transition.userInfo[</span><span style="color:#9ECBFF">@"key"</span><span style="color:#E1E4E8">];</span></span>
<span class="line"><span style="color:#79B8FF">        NSLog</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">@"unread WillExit: </span><span style="color:#79B8FF">%@</span><span style="color:#9ECBFF">"</span><span style="color:#E1E4E8">, userInfo);</span></span>
<span class="line"><span style="color:#E1E4E8">    }];</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#E1E4E8">    [unread </span><span style="color:#79B8FF">setWillEnterStateBlock:</span><span style="color:#F97583">^</span><span style="color:#E1E4E8">(TKState </span><span style="color:#F97583">*</span><span style="color:#E1E4E8">state, TKTransition </span><span style="color:#F97583">*</span><span style="color:#E1E4E8">transition) {</span></span>
<span class="line"><span style="color:#79B8FF">        NSString</span><span style="color:#F97583"> *</span><span style="color:#E1E4E8">userInfo </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> transition.userInfo[</span><span style="color:#9ECBFF">@"key"</span><span style="color:#E1E4E8">];</span></span>
<span class="line"><span style="color:#79B8FF">        NSLog</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">@"unread WillEnter: </span><span style="color:#79B8FF">%@</span><span style="color:#9ECBFF">"</span><span style="color:#E1E4E8">, userInfo);</span></span>
<span class="line"><span style="color:#E1E4E8">    }];</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#E1E4E8">    [unread </span><span style="color:#79B8FF">setDidExitStateBlock:</span><span style="color:#F97583">^</span><span style="color:#E1E4E8">(TKState </span><span style="color:#F97583">*</span><span style="color:#E1E4E8">state, TKTransition </span><span style="color:#F97583">*</span><span style="color:#E1E4E8">transition) {</span></span>
<span class="line"><span style="color:#79B8FF">        NSString</span><span style="color:#F97583"> *</span><span style="color:#E1E4E8">userInfo </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> transition.userInfo[</span><span style="color:#9ECBFF">@"key"</span><span style="color:#E1E4E8">];</span></span>
<span class="line"><span style="color:#79B8FF">        NSLog</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">@"unread DidExit: </span><span style="color:#79B8FF">%@</span><span style="color:#9ECBFF">"</span><span style="color:#E1E4E8">, userInfo);</span></span>
<span class="line"><span style="color:#E1E4E8">    }];</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#E1E4E8">    [unread </span><span style="color:#79B8FF">setDidEnterStateBlock:</span><span style="color:#F97583">^</span><span style="color:#E1E4E8">(TKState </span><span style="color:#F97583">*</span><span style="color:#E1E4E8">state, TKTransition </span><span style="color:#F97583">*</span><span style="color:#E1E4E8">transition) {</span></span>
<span class="line"><span style="color:#79B8FF">        NSString</span><span style="color:#F97583"> *</span><span style="color:#E1E4E8">userInfo </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> transition.userInfo[</span><span style="color:#9ECBFF">@"key"</span><span style="color:#E1E4E8">];</span></span>
<span class="line"><span style="color:#79B8FF">        NSLog</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">@"unread DidEnter: </span><span style="color:#79B8FF">%@</span><span style="color:#9ECBFF">"</span><span style="color:#E1E4E8">, userInfo);</span></span>
<span class="line"><span style="color:#E1E4E8">    }];</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#6A737D">    // 3.å®šä¹‰å·²è¯»çŠ¶æ€</span></span>
<span class="line"><span style="color:#E1E4E8">    TKState </span><span style="color:#F97583">*</span><span style="color:#E1E4E8">read </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> [TKState </span><span style="color:#79B8FF">stateWithName:</span><span style="color:#9ECBFF">@"read"</span><span style="color:#E1E4E8">];</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#E1E4E8">    [read </span><span style="color:#79B8FF">setWillExitStateBlock:</span><span style="color:#F97583">^</span><span style="color:#E1E4E8">(TKState </span><span style="color:#F97583">*</span><span style="color:#E1E4E8">state, TKTransition </span><span style="color:#F97583">*</span><span style="color:#E1E4E8">transition) {</span></span>
<span class="line"><span style="color:#79B8FF">        NSString</span><span style="color:#F97583"> *</span><span style="color:#E1E4E8">userInfo </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> transition.userInfo[</span><span style="color:#9ECBFF">@"key"</span><span style="color:#E1E4E8">];</span></span>
<span class="line"><span style="color:#79B8FF">        NSLog</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">@"read WillExit: </span><span style="color:#79B8FF">%@</span><span style="color:#9ECBFF">"</span><span style="color:#E1E4E8">, userInfo);</span></span>
<span class="line"><span style="color:#E1E4E8">    }];</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#E1E4E8">    [read </span><span style="color:#79B8FF">setWillEnterStateBlock:</span><span style="color:#F97583">^</span><span style="color:#E1E4E8">(TKState </span><span style="color:#F97583">*</span><span style="color:#E1E4E8">state, TKTransition </span><span style="color:#F97583">*</span><span style="color:#E1E4E8">transition) {</span></span>
<span class="line"><span style="color:#79B8FF">        NSString</span><span style="color:#F97583"> *</span><span style="color:#E1E4E8">userInfo </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> transition.userInfo[</span><span style="color:#9ECBFF">@"key"</span><span style="color:#E1E4E8">];</span></span>
<span class="line"><span style="color:#79B8FF">        NSLog</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">@"read WillEnter: </span><span style="color:#79B8FF">%@</span><span style="color:#9ECBFF">"</span><span style="color:#E1E4E8">, userInfo);</span></span>
<span class="line"><span style="color:#E1E4E8">    }];</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#E1E4E8">    [read </span><span style="color:#79B8FF">setDidExitStateBlock:</span><span style="color:#F97583">^</span><span style="color:#E1E4E8">(TKState </span><span style="color:#F97583">*</span><span style="color:#E1E4E8">state, TKTransition </span><span style="color:#F97583">*</span><span style="color:#E1E4E8">transition) {</span></span>
<span class="line"><span style="color:#79B8FF">        NSString</span><span style="color:#F97583"> *</span><span style="color:#E1E4E8">userInfo </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> transition.userInfo[</span><span style="color:#9ECBFF">@"key"</span><span style="color:#E1E4E8">];</span></span>
<span class="line"><span style="color:#79B8FF">        NSLog</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">@"read DidExit: </span><span style="color:#79B8FF">%@</span><span style="color:#9ECBFF">"</span><span style="color:#E1E4E8">, userInfo);</span></span>
<span class="line"><span style="color:#E1E4E8">    }];</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#E1E4E8">    [read </span><span style="color:#79B8FF">setDidEnterStateBlock:</span><span style="color:#F97583">^</span><span style="color:#E1E4E8">(TKState </span><span style="color:#F97583">*</span><span style="color:#E1E4E8">state, TKTransition </span><span style="color:#F97583">*</span><span style="color:#E1E4E8">transition) {</span></span>
<span class="line"><span style="color:#79B8FF">        NSString</span><span style="color:#F97583"> *</span><span style="color:#E1E4E8">userInfo </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> transition.userInfo[</span><span style="color:#9ECBFF">@"key"</span><span style="color:#E1E4E8">];</span></span>
<span class="line"><span style="color:#79B8FF">        NSLog</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">@"read DidEnter: </span><span style="color:#79B8FF">%@</span><span style="color:#9ECBFF">"</span><span style="color:#E1E4E8">, userInfo);</span></span>
<span class="line"><span style="color:#E1E4E8">    }];</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#6A737D">    // 4.å®šä¹‰åˆ é™¤çŠ¶æ€</span></span>
<span class="line"><span style="color:#E1E4E8">    TKState </span><span style="color:#F97583">*</span><span style="color:#E1E4E8">delete </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> [TKState </span><span style="color:#79B8FF">stateWithName:</span><span style="color:#9ECBFF">@"delete"</span><span style="color:#E1E4E8">];</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#E1E4E8">    [delete </span><span style="color:#79B8FF">setWillExitStateBlock:</span><span style="color:#F97583">^</span><span style="color:#E1E4E8">(TKState </span><span style="color:#F97583">*</span><span style="color:#E1E4E8">state, TKTransition </span><span style="color:#F97583">*</span><span style="color:#E1E4E8">transition) {</span></span>
<span class="line"><span style="color:#79B8FF">        NSString</span><span style="color:#F97583"> *</span><span style="color:#E1E4E8">userInfo </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> transition.userInfo[</span><span style="color:#9ECBFF">@"key"</span><span style="color:#E1E4E8">];</span></span>
<span class="line"><span style="color:#79B8FF">        NSLog</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">@"delete WillExit: </span><span style="color:#79B8FF">%@</span><span style="color:#9ECBFF">"</span><span style="color:#E1E4E8">, userInfo);</span></span>
<span class="line"><span style="color:#E1E4E8">    }];</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#E1E4E8">    [delete </span><span style="color:#79B8FF">setWillEnterStateBlock:</span><span style="color:#F97583">^</span><span style="color:#E1E4E8">(TKState </span><span style="color:#F97583">*</span><span style="color:#E1E4E8">state, TKTransition </span><span style="color:#F97583">*</span><span style="color:#E1E4E8">transition) {</span></span>
<span class="line"><span style="color:#79B8FF">        NSString</span><span style="color:#F97583"> *</span><span style="color:#E1E4E8">userInfo </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> transition.userInfo[</span><span style="color:#9ECBFF">@"key"</span><span style="color:#E1E4E8">];</span></span>
<span class="line"><span style="color:#79B8FF">        NSLog</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">@"delete WillEnter: </span><span style="color:#79B8FF">%@</span><span style="color:#9ECBFF">"</span><span style="color:#E1E4E8">, userInfo);</span></span>
<span class="line"><span style="color:#E1E4E8">    }];</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#E1E4E8">    [delete </span><span style="color:#79B8FF">setDidExitStateBlock:</span><span style="color:#F97583">^</span><span style="color:#E1E4E8">(TKState </span><span style="color:#F97583">*</span><span style="color:#E1E4E8">state, TKTransition </span><span style="color:#F97583">*</span><span style="color:#E1E4E8">transition) {</span></span>
<span class="line"><span style="color:#79B8FF">        NSString</span><span style="color:#F97583"> *</span><span style="color:#E1E4E8">userInfo </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> transition.userInfo[</span><span style="color:#9ECBFF">@"key"</span><span style="color:#E1E4E8">];</span></span>
<span class="line"><span style="color:#79B8FF">        NSLog</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">@"delete DidExit: </span><span style="color:#79B8FF">%@</span><span style="color:#9ECBFF">"</span><span style="color:#E1E4E8">, userInfo);</span></span>
<span class="line"><span style="color:#E1E4E8">    }];</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#E1E4E8">    [delete </span><span style="color:#79B8FF">setDidEnterStateBlock:</span><span style="color:#F97583">^</span><span style="color:#E1E4E8">(TKState </span><span style="color:#F97583">*</span><span style="color:#E1E4E8">state, TKTransition </span><span style="color:#F97583">*</span><span style="color:#E1E4E8">transition) {</span></span>
<span class="line"><span style="color:#79B8FF">        NSString</span><span style="color:#F97583"> *</span><span style="color:#E1E4E8">userInfo </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> transition.userInfo[</span><span style="color:#9ECBFF">@"key"</span><span style="color:#E1E4E8">];</span></span>
<span class="line"><span style="color:#79B8FF">        NSLog</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">@"delete DidEnter: </span><span style="color:#79B8FF">%@</span><span style="color:#9ECBFF">"</span><span style="color:#E1E4E8">, userInfo);</span></span>
<span class="line"><span style="color:#E1E4E8">    }];</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#E1E4E8">    TKEvent </span><span style="color:#F97583">*</span><span style="color:#E1E4E8">readEvent </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> [TKEvent </span><span style="color:#79B8FF">eventWithName:</span><span style="color:#9ECBFF">@"read"</span><span style="color:#79B8FF"> transitioningFromStates:</span><span style="color:#E1E4E8">@[unread] </span><span style="color:#79B8FF">toState:</span><span style="color:#E1E4E8">read];</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#E1E4E8">    [readEvent </span><span style="color:#79B8FF">setWillFireEventBlock:</span><span style="color:#F97583">^</span><span style="color:#E1E4E8">(TKEvent </span><span style="color:#F97583">*</span><span style="color:#E1E4E8">event, TKTransition </span><span style="color:#F97583">*</span><span style="color:#E1E4E8">transition) {</span></span>
<span class="line"><span style="color:#79B8FF">        NSString</span><span style="color:#F97583"> *</span><span style="color:#E1E4E8">userInfo </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> transition.userInfo[</span><span style="color:#9ECBFF">@"key"</span><span style="color:#E1E4E8">];</span></span>
<span class="line"><span style="color:#79B8FF">        NSLog</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">@"readEvent WillFire: </span><span style="color:#79B8FF">%@</span><span style="color:#9ECBFF">"</span><span style="color:#E1E4E8">, userInfo);</span></span>
<span class="line"><span style="color:#E1E4E8">    }];</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#E1E4E8">    [readEvent </span><span style="color:#79B8FF">setDidFireEventBlock:</span><span style="color:#F97583">^</span><span style="color:#E1E4E8">(TKEvent </span><span style="color:#F97583">*</span><span style="color:#E1E4E8">event, TKTransition </span><span style="color:#F97583">*</span><span style="color:#E1E4E8">transition) {</span></span>
<span class="line"><span style="color:#79B8FF">        NSString</span><span style="color:#F97583"> *</span><span style="color:#E1E4E8">userInfo </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> transition.userInfo[</span><span style="color:#9ECBFF">@"key"</span><span style="color:#E1E4E8">];</span></span>
<span class="line"><span style="color:#79B8FF">        NSLog</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">@"readEvent DidFire: </span><span style="color:#79B8FF">%@</span><span style="color:#9ECBFF">"</span><span style="color:#E1E4E8">, userInfo);</span></span>
<span class="line"><span style="color:#E1E4E8">    }];</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#E1E4E8">    TKEvent </span><span style="color:#F97583">*</span><span style="color:#E1E4E8">deleteEvent </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> [TKEvent </span><span style="color:#79B8FF">eventWithName:</span><span style="color:#9ECBFF">@"delete"</span><span style="color:#79B8FF"> transitioningFromStates:</span><span style="color:#E1E4E8">@[read, unread] </span><span style="color:#79B8FF">toState:</span><span style="color:#E1E4E8">delete];</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#E1E4E8">    [deleteEvent </span><span style="color:#79B8FF">setWillFireEventBlock:</span><span style="color:#F97583">^</span><span style="color:#E1E4E8">(TKEvent </span><span style="color:#F97583">*</span><span style="color:#E1E4E8">event, TKTransition </span><span style="color:#F97583">*</span><span style="color:#E1E4E8">transition) {</span></span>
<span class="line"><span style="color:#79B8FF">        NSString</span><span style="color:#F97583"> *</span><span style="color:#E1E4E8">userInfo </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> transition.userInfo[</span><span style="color:#9ECBFF">@"key"</span><span style="color:#E1E4E8">];</span></span>
<span class="line"><span style="color:#79B8FF">        NSLog</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">@"deleteEvent WillFire: </span><span style="color:#79B8FF">%@</span><span style="color:#9ECBFF">"</span><span style="color:#E1E4E8">, userInfo);</span></span>
<span class="line"><span style="color:#E1E4E8">    }];</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#E1E4E8">    [deleteEvent </span><span style="color:#79B8FF">setDidFireEventBlock:</span><span style="color:#F97583">^</span><span style="color:#E1E4E8">(TKEvent </span><span style="color:#F97583">*</span><span style="color:#E1E4E8">event, TKTransition </span><span style="color:#F97583">*</span><span style="color:#E1E4E8">transition) {</span></span>
<span class="line"><span style="color:#79B8FF">        NSString</span><span style="color:#F97583"> *</span><span style="color:#E1E4E8">userInfo </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> transition.userInfo[</span><span style="color:#9ECBFF">@"key"</span><span style="color:#E1E4E8">];</span></span>
<span class="line"><span style="color:#79B8FF">        NSLog</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">@"deleteEvent DidFire: </span><span style="color:#79B8FF">%@</span><span style="color:#9ECBFF">"</span><span style="color:#E1E4E8">, userInfo);</span></span>
<span class="line"><span style="color:#E1E4E8">    }];</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#6A737D">    // 5.é…ç½®å¹¶å¯åŠ¨machine</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#79B8FF">    NSLog</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">@"ğŸ”¥1.åˆå§‹åŒ–machine"</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#E1E4E8">    [machine </span><span style="color:#79B8FF">addStates:</span><span style="color:#E1E4E8">@[read, unread, delete]];</span></span>
<span class="line"><span style="color:#E1E4E8">    [machine </span><span style="color:#79B8FF">addEvents:</span><span style="color:#E1E4E8">@[readEvent, deleteEvent]];</span></span>
<span class="line"><span style="color:#E1E4E8">    [machine </span><span style="color:#79B8FF">setInitialState:</span><span style="color:#E1E4E8">unread];</span></span>
<span class="line"><span style="color:#E1E4E8">    [machine </span><span style="color:#79B8FF">activate</span><span style="color:#E1E4E8">];</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#6A737D">    // 6.è§¦å‘event</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#79B8FF">    NSError</span><span style="color:#F97583"> *</span><span style="color:#E1E4E8">error </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> nil</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#79B8FF">    NSLog</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">@"-------->1.å½“å‰çŠ¶æ€---> </span><span style="color:#79B8FF">%@</span><span style="color:#9ECBFF">"</span><span style="color:#E1E4E8">, [machine </span><span style="color:#79B8FF">currentState</span><span style="color:#E1E4E8">]);</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#6A737D">		// è§¦å‘ä»unreadåˆ°readçš„event</span></span>
<span class="line"><span style="color:#E1E4E8">    [machine </span><span style="color:#79B8FF">fireEvent:</span><span style="color:#E1E4E8">readEvent </span><span style="color:#79B8FF">userInfo:</span><span style="color:#E1E4E8">@{</span><span style="color:#9ECBFF">@"key"</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">@"unread to read"</span><span style="color:#E1E4E8">} </span><span style="color:#79B8FF">error:</span><span style="color:#F97583">&#x26;</span><span style="color:#E1E4E8">error];</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#79B8FF">    NSLog</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">@"-------->2.å½“å‰çŠ¶æ€---> </span><span style="color:#79B8FF">%@</span><span style="color:#9ECBFF">"</span><span style="color:#E1E4E8">, [machine </span><span style="color:#79B8FF">currentState</span><span style="color:#E1E4E8">]);</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#6A737D">		// è§¦å‘ä»unread/delete</span></span>
<span class="line"><span style="color:#E1E4E8">    [machine </span><span style="color:#79B8FF">fireEvent:</span><span style="color:#E1E4E8">deleteEvent </span><span style="color:#79B8FF">userInfo:</span><span style="color:#E1E4E8">@{</span><span style="color:#9ECBFF">@"key"</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">@"unread/read to delete"</span><span style="color:#E1E4E8">} </span><span style="color:#79B8FF">error:</span><span style="color:#F97583">&#x26;</span><span style="color:#E1E4E8">error];</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#79B8FF">    NSLog</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">@"-------->3.å½“å‰çŠ¶æ€---> </span><span style="color:#79B8FF">%@</span><span style="color:#9ECBFF">"</span><span style="color:#E1E4E8">, [machine </span><span style="color:#79B8FF">currentState</span><span style="color:#E1E4E8">]);</span></span>
<span class="line"></span></code></pre>
<hr>
<p>å‚è€ƒï¼š</p>
<ul>
<li><a href="https://baike.baidu.com/item/%E7%8A%B6%E6%80%81%E6%9C%BA/6548513?fr=aladdin">https://baike.baidu.com/item/%E7%8A%B6%E6%80%81%E6%9C%BA/6548513?fr=aladdin</a></li>
<li><a href="http://www.ruanyifeng.com/blog/2016/09/redux_tutorial_part_one_basic_usages.html">http://www.ruanyifeng.com/blog/2016/09/redux_tutorial_part_one_basic_usages.html</a></li>
</ul> </section> </div> </div> </div> </div> </div> </body></html>