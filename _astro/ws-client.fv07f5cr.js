import{_ as S,W as C}from"./session-store.Dd2HyGIM.js";import{i as _,c as p,a,t as c,n as A,d as T,f as w}from"./pinia.GsotNk0y.js";const y=w({__name:"ConfirmModal",props:{modelValue:{type:Boolean},title:{},description:{},cancelText:{},confirmText:{},danger:{type:Boolean}},emits:["update:modelValue","confirm"],setup(t,{expose:e}){e();const n={};return Object.defineProperty(n,"__isScriptSetup",{enumerable:!1,value:!0}),n}}),b=["aria-label"],v={class:"relative w-full max-w-sm rounded-2xl border p-6 text-center modal-content",style:{background:"var(--surface-1)","border-color":"var(--ink-4)","box-shadow":"var(--shadow-modal)"}},D={class:"text-lg font-semibold mb-2",style:{color:"var(--ink-0)","font-family":"var(--font-heading)"}},E={class:"text-sm mb-6",style:{color:"var(--ink-2)"}},k={class:"flex gap-3"};function x(t,e,n,r,o,s){return n.modelValue?(_(),p("div",{key:0,class:"fixed inset-0 z-[60] flex items-center justify-center p-4",role:"alertdialog","aria-label":n.title},[a("div",{class:"absolute inset-0 bg-black/30",onClick:e[0]||(e[0]=l=>t.$emit("update:modelValue",!1))}),a("div",v,[a("h3",D,c(n.title),1),a("p",E,c(n.description),1),a("div",k,[a("button",{class:"flex-1 py-2.5 rounded-xl text-sm font-medium border",style:{"border-color":"var(--ink-4)",color:"var(--ink-1)"},onClick:e[1]||(e[1]=l=>t.$emit("update:modelValue",!1))},c(n.cancelText),1),a("button",{class:"flex-1 py-2.5 rounded-xl text-sm font-semibold",style:A(n.danger?"background: var(--danger); color: white;":"background: var(--ink-0); color: white;"),onClick:e[2]||(e[2]=l=>t.$emit("confirm"))},c(n.confirmText),5)])])],8,b)):T("",!0)}const $=S(y,[["render",x]]);function d(t){return String(t||"").trim()}function B(t={}){const e=String(t.roomLabel||"频道"),n=d(t.targetCode),r=d(t.currentCode),o=!!t.currentRoom,s=!!t.isOwner;return n?o?r&&r===n?{action:"already_in_target",requiresConfirm:!1,prompt:""}:s?{action:"close_then_join",requiresConfirm:!0,prompt:`你当前在自己的${e}中。要先关闭当前${e}，再加入 ${n} 吗？`}:{action:"leave_then_join",requiresConfirm:!0,prompt:`你当前在一个${e}中。要先退出当前${e}，再加入 ${n} 吗？`}:{action:"join_direct",requiresConfirm:!1,prompt:""}:{action:"invalid_target",requiresConfirm:!1,prompt:""}}function R(t){if(!t)return"";const e=new Date(typeof t=="number"?t:Date.parse(String(t)));if(Number.isNaN(e.getTime()))return"";const n=new Date,r=e.toDateString()===n.toDateString(),o=String(e.getHours()).padStart(2,"0"),s=String(e.getMinutes()).padStart(2,"0");if(r)return`${o}:${s}`;const l=e.getMonth()+1,g=e.getDate();return`${l}/${g} ${o}:${s}`}function O(t){if(!t||t<=0)return"0 B";const e=["B","KB","MB","GB"];let n=0,r=t;for(;r>=1024&&n<e.length-1;)r/=1024,n+=1;return`${r.toFixed(n===0?0:1)} ${e[n]}`}function F(t){if(!t)return"?";const e=String(t).trim();return e?/[\u4e00-\u9fff]/.test(e[0])?e[0]:e[0].toUpperCase():"?"}const m=["#E7E5E4","#D6D3D1","#A8A29E","#FED7AA","#FDE68A","#BBF7D0","#BAE6FD","#C4B5FD","#FBCFE8","#FCA5A5"];function I(t){if(!t)return m[0];let e=0;for(let n=0;n<t.length;n+=1)e=(e<<5)-e+t.charCodeAt(n)|0;return m[Math.abs(e)%m.length]}const i={CHAT_CHANNEL:"fh:chat:selectedChannel",CHAT_SCROLL:"fh:chat:scroll:",CHAT_DRAFT:"fh:chat:draft:",CHESS_GAME:"fh:chess:selectedGame"};function u(t){try{return localStorage.getItem(t)}catch{return null}}function f(t,e){try{localStorage.setItem(t,e)}catch{}}function h(t){try{localStorage.removeItem(t)}catch{}}function L(){return u(i.CHAT_CHANNEL)||""}function P(t){if(!t){h(i.CHAT_CHANNEL);return}f(i.CHAT_CHANNEL,String(t))}function M(t){return u(i.CHAT_DRAFT+String(t||""))||""}function G(t,e){if(t){if(!e){h(i.CHAT_DRAFT+t);return}f(i.CHAT_DRAFT+t,e)}}function W(t){t&&h(i.CHAT_DRAFT+t)}function V(t){return t&&Number(u(i.CHAT_SCROLL+t))||0}function j(t,e){t&&f(i.CHAT_SCROLL+t,String(e||0))}function q(){return u(i.CHESS_GAME)||""}function z(t){if(!t){h(i.CHESS_GAME);return}f(i.CHESS_GAME,String(t))}class J{path;url;ws=null;handlers={};reconnectTimer=null;reconnectDelay=1e3;maxReconnectDelay=3e4;intentionalClose=!1;pingInterval=null;constructor(e){this.path=e,this.url=`${C}${e}`}on(e,n){return this.handlers[e]||(this.handlers[e]=[]),this.handlers[e].push(n),this}off(e,n){this.handlers[e]&&(this.handlers[e]=this.handlers[e].filter(r=>r!==n))}emit(e,n){const r=this.handlers[e]||[];for(const o of r)try{o(n)}catch(s){console.error("ws handler error",s)}}connect(){this.ws&&(this.ws.readyState===WebSocket.CONNECTING||this.ws.readyState===WebSocket.OPEN)||(this.intentionalClose=!1,this.ws=new WebSocket(this.url),this.ws.onopen=()=>{this.reconnectDelay=1e3,this.emit("_open",null),this.startPing()},this.ws.onmessage=e=>{let n;try{n=JSON.parse(String(e.data||""))}catch{return}!n||!n.type||(this.emit(n.type,n),this.emit("_message",n))},this.ws.onclose=()=>{this.stopPing(),this.emit("_close",null),this.intentionalClose||this.scheduleReconnect()},this.ws.onerror=()=>{this.emit("_error",null)})}send(e){this.ws&&this.ws.readyState===WebSocket.OPEN&&this.ws.send(JSON.stringify(e))}close(){this.intentionalClose=!0,this.reconnectTimer&&(clearTimeout(this.reconnectTimer),this.reconnectTimer=null),this.stopPing(),this.ws&&this.ws.close()}scheduleReconnect(){this.reconnectTimer&&clearTimeout(this.reconnectTimer),this.reconnectTimer=window.setTimeout(()=>{this.connect()},this.reconnectDelay),this.reconnectDelay=Math.min(this.reconnectDelay*1.5,this.maxReconnectDelay)}startPing(){this.stopPing(),this.pingInterval=window.setInterval(()=>{this.send({type:"ping"})},25e3)}stopPing(){this.pingInterval&&(clearInterval(this.pingInterval),this.pingInterval=null)}get connected(){return!!(this.ws&&this.ws.readyState===WebSocket.OPEN)}get socketPath(){return this.path}}export{$ as C,J as W,I as a,q as b,O as c,B as d,V as e,R as f,F as g,j as h,G as i,W as j,M as k,P as l,L as m,z as s};
