import{v as c,w as I}from"./runtime-dom.esm-bundler.Cc_N6hud.js";import{T as B}from"./ToastHost.CQvuvMz1.js";import{_ as L,u as K,s as D}from"./session-store.Dd2HyGIM.js";import{r as H}from"./use-session-guard.CHYobJ7L.js";import{c as k,a as o,b as P,n as u,w as m,t as _,d as R,e as O,f as q,o as F,g as G,r,h as J,i as C}from"./pinia.GsotNk0y.js";const Q=q({__name:"ApplicationsAuthPage",setup(j,{expose:n}){n();const p=K(),e=r("login"),T=r("username"),M=r(""),v=r(""),t=r(""),x=r(""),y=r(""),V=r(""),f=r(!1),l=r(""),b=r(0);let s=null;const S=r(null),U=r(!1);let d=null;function w(a,i="info"){d&&window.clearTimeout(d),U.value=!1,S.value={message:a,type:i},d=window.setTimeout(()=>{U.value=!0,window.setTimeout(()=>{S.value=null},200)},2400)}function h(a,i){if(!a||typeof a!="object")return i;const g=a;return g.data?.error||g.data?.message||g.message||i}async function z(){l.value="";const a=M.value.trim(),i=v.value;if(!a||!i){l.value="请填写账号和密码";return}f.value=!0;try{await p.login({identifier:a,password:i,useNumber:T.value==="number"}),w("登录成功"),window.location.href="/applications"}catch(g){l.value=h(g,"登录失败，请重试")}finally{f.value=!1}}async function A(){l.value="";const a=y.value.trim();if(!a){l.value="请先输入邮箱";return}try{await D(a,"register"),w("验证码已发送"),b.value=60,s&&window.clearInterval(s),s=window.setInterval(()=>{b.value-=1,b.value<=0&&s&&(window.clearInterval(s),s=null)},1e3)}catch(i){l.value=h(i,"验证码发送失败，请重试")}}async function N(){if(l.value="",!t.value.trim()||!x.value||!y.value.trim()||!V.value.trim()){l.value="请填写完整注册信息";return}if(x.value.length<6){l.value="密码至少 6 位";return}f.value=!0;try{await p.register({username:t.value.trim(),password:x.value,email:y.value.trim(),code:V.value.trim()}),w("注册成功"),window.location.href="/applications"}catch(a){l.value=h(a,"注册失败，请重试")}finally{f.value=!1}}F(async()=>{await H("/applications")}),G(()=>{s&&window.clearInterval(s),d&&window.clearTimeout(d)});const E={sessionStore:p,authMode:e,loginType:T,loginId:M,loginPassword:v,regUsername:t,regPassword:x,regEmail:y,regCode:V,busy:f,errorMessage:l,codeCooldown:b,get cooldownTimer(){return s},set cooldownTimer(a){s=a},toast:S,toastExiting:U,get toastTimer(){return d},set toastTimer(a){d=a},showToast:w,normalizeError:h,handleLogin:z,handleSendCode:A,handleRegister:N,ToastHost:B};return Object.defineProperty(E,"__isScriptSetup",{enumerable:!1,value:!0}),E}}),W={class:"min-h-screen bg-surface-0 font-sans relative noise-overlay grid-pattern flex flex-col"},X={class:"relative z-10 animate-fade-in delay-100",style:{"view-transition-name":"top-nav"}},Y={class:"max-w-6xl mx-auto px-6 md:px-10 lg:px-16"},Z={class:"flex items-center justify-between h-16 md:h-20"},$={class:"flex items-center gap-2.5"},ee={class:"w-8 h-8 bg-ink-0 rounded-lg flex items-center justify-center"},oe={class:"flex items-center gap-1 relative"},ne={href:"https://fivehow.com",class:"nav-link flex items-center gap-1.5 px-3 py-1.5 rounded-lg text-ink-2 text-sm font-medium"},te={class:"relative z-10 flex-1 flex items-center justify-center px-6 pb-12"},ae={class:"w-full max-w-sm animate-fade-in-up delay-200"},re={class:"rounded-2xl border p-7 bg-surface-1",style:{"border-color":"color-mix(in srgb, var(--ink-4) 60%, transparent)","box-shadow":"var(--shadow-card)"}},le={class:"flex gap-1 mb-6 p-1 rounded-lg",style:{background:"var(--surface-2)"}},se={key:0,class:"space-y-4"},ie={class:"flex gap-1 mb-2"},de=["placeholder"],ce=["disabled"],ue={key:1,class:"space-y-4"},me={class:"flex gap-2"},ve=["disabled"],fe=["disabled"],ge={key:2,class:"mt-3 text-xs text-center",style:{color:"var(--danger)"}};function pe(j,n,p,e,T,M){const v=J("iconify-icon");return C(),k("div",W,[o("header",X,[o("div",Y,[o("div",Z,[o("div",$,[o("div",ee,[P(v,{icon:"lucide:layers",class:"text-white text-sm"})]),n[10]||(n[10]=o("span",{class:"font-display font-semibold text-ink-0 text-base tracking-tight hidden sm:inline"},"应用中心",-1))]),o("nav",oe,[o("a",ne,[P(v,{icon:"lucide:home",class:"text-base"}),n[11]||(n[11]=o("span",{class:"hidden sm:inline"},"主页",-1))])])])])]),o("main",te,[o("section",ae,[n[12]||(n[12]=o("div",{class:"text-center mb-8"},[o("h1",{class:"font-display font-bold text-3xl md:text-4xl tracking-tight mb-2 text-ink-0"},"欢迎回来"),o("p",{class:"text-sm text-ink-2"},"登录以使用 Chat / Chess")],-1)),o("div",re,[o("div",le,[o("button",{class:"flex-1 py-2 rounded-md text-sm font-medium transition-all",style:u(e.authMode==="login"?"background: var(--surface-1); color: var(--ink-0); box-shadow: 0 1px 3px rgba(0,0,0,0.08)":"color: var(--ink-2)"),onClick:n[0]||(n[0]=t=>e.authMode="login")}," 登录 ",4),o("button",{class:"flex-1 py-2 rounded-md text-sm font-medium transition-all",style:u(e.authMode==="register"?"background: var(--surface-1); color: var(--ink-0); box-shadow: 0 1px 3px rgba(0,0,0,0.08)":"color: var(--ink-2)"),onClick:n[1]||(n[1]=t=>e.authMode="register")}," 注册 ",4)]),e.authMode==="login"?(C(),k("div",se,[o("div",ie,[o("button",{class:"text-xs font-medium px-2 py-1 rounded",style:u(e.loginType==="username"?"background: var(--ink-0); color: white":"color: var(--ink-2)"),onClick:n[2]||(n[2]=t=>e.loginType="username")}," 用户名 ",4),o("button",{class:"text-xs font-medium px-2 py-1 rounded",style:u(e.loginType==="number"?"background: var(--ink-0); color: white":"color: var(--ink-2)"),onClick:n[3]||(n[3]=t=>e.loginType="number")}," 用户号 ",4)]),m(o("input",{"onUpdate:modelValue":n[4]||(n[4]=t=>e.loginId=t),class:"fh-input w-full px-4 py-2.5 rounded-lg border text-sm outline-none transition-all",placeholder:e.loginType==="username"?"用户名":"用户号",style:{background:"var(--surface-0)","border-color":"var(--ink-4)",color:"var(--ink-0)"},onKeydown:I(e.handleLogin,["enter"])},null,40,de),[[c,e.loginId]]),m(o("input",{"onUpdate:modelValue":n[5]||(n[5]=t=>e.loginPassword=t),type:"password",class:"fh-input w-full px-4 py-2.5 rounded-lg border text-sm outline-none transition-all",placeholder:"密码",autocomplete:"current-password",style:{background:"var(--surface-0)","border-color":"var(--ink-4)",color:"var(--ink-0)"},onKeydown:I(e.handleLogin,["enter"])},null,544),[[c,e.loginPassword]]),o("button",{class:"w-full py-2.5 rounded-lg text-sm font-semibold transition-all",style:u(e.busy?"background: var(--ink-3); color: white; cursor: not-allowed":"background: var(--ink-0); color: white"),disabled:e.busy,onClick:e.handleLogin},_(e.busy?"登录中…":"登录"),13,ce)])):(C(),k("div",ue,[m(o("input",{"onUpdate:modelValue":n[6]||(n[6]=t=>e.regUsername=t),class:"fh-input w-full px-4 py-2.5 rounded-lg border text-sm outline-none transition-all",placeholder:"用户名",autocomplete:"username",style:{background:"var(--surface-0)","border-color":"var(--ink-4)",color:"var(--ink-0)"}},null,512),[[c,e.regUsername]]),m(o("input",{"onUpdate:modelValue":n[7]||(n[7]=t=>e.regPassword=t),type:"password",class:"fh-input w-full px-4 py-2.5 rounded-lg border text-sm outline-none transition-all",placeholder:"密码（至少 6 位）",autocomplete:"new-password",style:{background:"var(--surface-0)","border-color":"var(--ink-4)",color:"var(--ink-0)"}},null,512),[[c,e.regPassword]]),m(o("input",{"onUpdate:modelValue":n[8]||(n[8]=t=>e.regEmail=t),type:"email",class:"fh-input w-full px-4 py-2.5 rounded-lg border text-sm outline-none transition-all",placeholder:"邮箱",autocomplete:"email",style:{background:"var(--surface-0)","border-color":"var(--ink-4)",color:"var(--ink-0)"}},null,512),[[c,e.regEmail]]),o("div",me,[m(o("input",{"onUpdate:modelValue":n[9]||(n[9]=t=>e.regCode=t),class:"fh-input flex-1 px-4 py-2.5 rounded-lg border text-sm outline-none transition-all",placeholder:"验证码",inputmode:"numeric",maxlength:"6",style:{background:"var(--surface-0)","border-color":"var(--ink-4)",color:"var(--ink-0)"}},null,512),[[c,e.regCode]]),o("button",{class:"shrink-0 px-4 py-2.5 rounded-lg text-sm font-medium border transition-all",style:{"border-color":"var(--ink-4)",color:"var(--ink-1)"},disabled:e.codeCooldown>0,onClick:e.handleSendCode},_(e.codeCooldown>0?`${e.codeCooldown}s`:"发送"),9,ve)]),o("button",{class:"w-full py-2.5 rounded-lg text-sm font-semibold transition-all",style:u(e.busy?"background: var(--ink-3); color: white; cursor: not-allowed":"background: var(--ink-0); color: white"),disabled:e.busy,onClick:e.handleRegister},_(e.busy?"注册中…":"注册"),13,fe)])),e.errorMessage?(C(),k("p",ge,_(e.errorMessage),1)):R("",!0)])])]),n[13]||(n[13]=O('<footer class="relative z-10 py-6 animate-fade-in delay-500"><div class="max-w-6xl mx-auto px-6 md:px-10 lg:px-16"><div class="flex items-center justify-between text-xs text-ink-3"><span>v1.0.0</span><div class="flex items-center gap-1"><div class="w-1.5 h-1.5 rounded-full bg-emerald-400"></div><span>认证服务在线</span></div></div></div></footer>',1)),P(e.ToastHost,{toast:e.toast,exiting:e.toastExiting},null,8,["toast","exiting"])])}const ke=L(Q,[["render",pe]]);export{ke as default};
